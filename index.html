<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="Cristiano Franca" />
    <meta name="robots" content="index, follow" />
    <meta name="description" content="Web site to sell sweet and others" />
    <title>Paty Salgados e Doces</title>
    <link rel="stylesheet" href="/public/style.css" />
  </head>
  <style></style>
  <body>
    <div id="basket">
      <h3>Basket</h3>
      <button type="button" onclick="closeOrderBasket()" id="close-basket">
        <img src="/image/delete.png" alt="Close" id="close-img" />
      </button>
      <div id="basket-item"></div>
      <div id="final-order"></div>
      <button type="button" id="pedir">
        <img src="/image/delivery.png" alt="Enviar" id="send" />
      </button>

      <!-- Aqui será o basket -->
    </div>
    <div id="orderBox">
      <!-- Aqui será preenchido dinamicamente -->
    </div>
    <div id="container">
      <!-- Coloque isso no seu HTML -->

      <header>
        <div class="menu-wrapper" id="menuWrapper">
          <div class="menu-circle" id="menuCircle">
            <div class="menu-icon" id="menuIcon">☰</div>
            <div class="arc-buttons" id="arcButtons"></div>
          </div>
        </div>

        <!-- Modal -->
        <div id="modal" class="modal">
          <div id="textHTML"></div>
          <div id="btn-fechar">
          <button type="button" class="close-btn" onclick="closeModal()">
            Fechar
          </button>
          </div>
        </div>
        <h1>Paty Salgados e Doces</h1>
        <div class="login-area">
          <img src="/image/avatar.png" alt="avatar" class="logo" />
          <button type="button">
            <img src="/image/login.png" alt="Login" class="logo" />
          </button>
          <button type="button" onclick="openBasket()">
            <img
              src="/image/box_close.png"
              alt="Box"
              class="logo"
              id="box-img"
            />
          </button>
          <p id="basket-qt"></p>
        </div>
      </header>
      <p id="message"></p>
      <h4>Salgados</h4>
      <div class="slider-wrapper slider-wrapper1">
        <div id="sliderTrack1" class="slider-track"></div>
        <button type="button" class="nav-button prev-button" data-target="1">
          ◀
        </button>
        <button type="button" class="nav-button next-button" data-target="1">
          ▶
        </button>
      </div>
      <h4>Doces</h4>
      <div class="slider-wrapper slider-wrapper2">
        <div id="sliderTrack2" class="slider-track"></div>
        <button type="button" class="nav-button prev-button" data-target="2">
          ◀
        </button>
        <button type="button" class="nav-button next-button" data-target="2">
          ▶
        </button>
      </div>
      <footer>
        <div class="copyright">
          <a
            href="https://copyright-ru.vercel.app/"
            target="_blank"
            rel="noopener"
          >
            <img src="/image/copyright.png" alt="copyright" class="logo" />
          </a>
          <p>Copyright</p>
        </div>
        <div id="social-links">
          <a
            href="https://github.com/CristianoFranca1976"
            target="_blank"
            rel="noopener"
          >
            <img src="/image/github.png" alt="Github" class="logo" />
          </a>
          <a
            href="https://www.instagram.com/cristianofranca83/"
            target="_blank"
            rel="noopener"
          >
            <img src="/image/instagram.png" alt="Instagram" class="logo" />
          </a>
          <a
            href="https://www.youtube.com/channel/UCim3c539P4CJQOIMGPaT1oQ"
            target="_blank"
            rel="noopener"
          >
            <img src="/image/youtube.png" alt="Youtube" class="logo" />
          </a>
          <a
            href="https://www.linkedin.com/in/cristiano-franca-4a968627a/"
            target="_blank"
            rel="noopener"
          >
            <img src="/image/linkedin.png" alt="Linkedin" class="logo" />
          </a>
          <a href="https://donates.vercel.app/" target="_blank" rel="noopener">
            <img src="/image/donate.png" alt="Donate" class="logo" />
          </a>
        </div>
      </footer>
    </div>
    <script>
      const config = {
        slidesToShow: 5,
        centerMode: true,
        gap: 20,
      };

      const salgados = [
        {
          id: 0,
          label: "Pão de queijo",
          src: "/image/pao_de_Queijo.jpeg",
          pequeno: {
            mim: 50,
            value: 50,
          },
          medio: {
            mim: 25,
            value: 25,
          },
          price: {
            small: 0.3,
            medium: 1.0,
          },
          minimum: true,
          text: "Pão de queijo quentinho, feito com queijo fresco e polvilho azedo. Com o  minimo de 50 unidade do pequeno e 25 do médio.",
        },
        {
          id: 1,
          label: "Bolinha de Queijo",
          src: "/image/Bolinho_de_queijo.jpg",
          pequeno: {
            mim: 100,
            value: 100,
          },
          medio: {
            mim: 50,
            value: 50,
          },
          price: {
            small: 0.4,
            medium: 1.5,
          },
          minimum: true,
          text: "Bolinha de Queijo crocante por fora e recheio cremoso de queijo por dentro. Com o  minimo de 100 unidade do pequeno e 50 do médio.",
        },
        {
          id: 2,
          label: "Coxinha",
          src: "/image/coxinha.jpg",
          pequeno: {
            mim: 100,
            value: 100,
          },
          medio: {
            mim: 50,
            value: 50,
          },
          price: {
            small: 0.4,
            medium: 1.5,
          },
          minimum: true,
          text: "Coxinha de frango com massa crocante e recheio suculento. Com o  minimo de 100 unidade do pequeno e 50 do médio.",
        },
      ];

      const doces = [
        {
          id: 0,
          label: "Brigadeiro",
          src: "/image/brigadeiro.jpg",
          pequeno: {
            mim: 100,
            value: 100,
          },
          medio: {
            mim: 5,
            value: 5,
          },
          price: {
            small: 0.25,
            medium: 2,
          },
          minimum: true,
          text: "Brigadeiro cremoso, feito com leite condensado e granulado. Com o  minimo de 100 unidade do pequeno e 5 do médio gourmet.",
        },
        {
          id: 1,
          label: "Beijinho",
          src: "/image/beijinho.jpg",
          pequeno: {
            mim: 100,
            value: 100,
          },
          medio: {
            mim: 5,
            value: 5,
          },
          price: {
            small: 0.25,
            medium: 2,
          },
          minimum: true,
          text: "Beijinho de coco, feito com leite condensado e coberto com coco ralado. Com o  minimo de 100 unidade do pequeno e 5 do médio gourmet.",
        },
        {
          id: 2,
          label: "Olho de sogra ",
          src: "/image/olho_de_sogra.webp",
          pequeno: {
            mim: 100,
            value: 100,
          },
          medio: {
            mim: 50,
            value: 50,
          },
          price: {
            small: 0.3,
            medium: 2,
          },
          minimum: true,
          text: "Olho de sogra  feito com damasco, recheado com doce de leite e coberto com chocolate. Com o  minimo de 100 unidade do pequeno e 5 do médio. ",
        },
      ];

      function initSlider(images, trackId, wrapperClass) {
        const track = document.getElementById(trackId);
        const wrapper = document.querySelector(`.${wrapperClass}`);
        let slides = [];
        let currentLogicalIndex = 0;
        let currentPhysicalIndex = 0;
        let isTransitioning = false;

        let sideSlideSize = 0;
        let centerSlideSize = 0;
        let isMobile = window.innerWidth <= 768;

        function calculateWidths() {
          const containerSize = isMobile
            ? wrapper.offsetHeight
            : wrapper.offsetWidth;
          const totalGaps = config.gap * (config.slidesToShow - 1);
          const availableSize = containerSize - totalGaps;

          if (isMobile) {
            if (config.centerMode) {
              centerSlideSize = availableSize * 0.9; // before 0.4
              sideSlideSize =
                (availableSize - centerSlideSize) / (config.slidesToShow - 4); //before 1
            } else {
              sideSlideSize = availableSize / config.slidesToShow;
              centerSlideSize = sideSlideSize;
            }
          } else {
            if (config.centerMode) {
              centerSlideSize = availableSize * 0.4; // before 0.4
              sideSlideSize =
                (availableSize - centerSlideSize) / (config.slidesToShow - 1); //before 1
            } else {
              sideSlideSize = availableSize / config.slidesToShow;
              centerSlideSize = sideSlideSize;
            }
          }
        }

        function createSlide(item) {
          const slide = document.createElement("div");
          slide.className = "slide";
          slide.dataset.label = item.label;
          slide.dataset.id = item.id;
          slide.innerHTML = `
    <button type="button" class="btn-order" onclick='openOrder(${JSON.stringify(
      item
    )})'>
      <img src="${item.src}" alt="${item.label}">
    </button>
  `;
          return slide;
        }

        function buildInfiniteTrack() {
          track.innerHTML = "";
          calculateWidths();
          const repeatCount = 20;

          for (let rep = 0; rep < repeatCount; rep++) {
            images.forEach((item) => {
              const slide = createSlide(item);
              track.appendChild(slide);
            });
          }

          slides = Array.from(track.children);
          currentPhysicalIndex = Math.floor(slides.length / 2);
          currentLogicalIndex = currentPhysicalIndex % images.length;
          applyWidths();
        }

        function applyWidths() {
          slides.forEach((slide, index) => {
            const isCenter =
              index === currentPhysicalIndex && config.centerMode;
            const size = isCenter ? centerSlideSize : sideSlideSize;

            if (isMobile) {
              slide.style.height = `${size}px`;
              slide.style.marginTop = "0px";
              slide.style.marginBottom = `${config.gap}px`;
            } else {
              slide.style.width = `${size}px`;
              slide.style.height = "300px";
              slide.style.marginLeft = "0px";
              slide.style.marginRight = `${config.gap}px`;
            }
          });

          if (slides.length > 0) {
            if (isMobile) {
              slides[slides.length - 1].style.marginBottom = "0px";
            } else {
              slides[slides.length - 1].style.marginRight = "0px";
            }
          }
        }

        function getCenterOffset(slideIndex) {
          const containerCenter = isMobile
            ? wrapper.offsetHeight / 2
            : wrapper.offsetWidth / 2;
          let offset = 0;

          for (let i = 0; i < slideIndex; i++) {
            const size =
              i === currentPhysicalIndex ? centerSlideSize : sideSlideSize;
            offset += size + config.gap;
          }

          const currentSize =
            slideIndex === currentPhysicalIndex
              ? centerSlideSize
              : sideSlideSize;
          offset += currentSize / 2;

          return offset - containerCenter;
        }

        function updateSlider(animate = true) {
          if (isTransitioning && animate) return;
          applyWidths();

          slides.forEach((slide) => slide.classList.remove("active"));
          if (slides[currentPhysicalIndex] && config.centerMode) {
            slides[currentPhysicalIndex].classList.add("active");
          }

          const offset = getCenterOffset(currentPhysicalIndex);
          const direction = isMobile ? "translateY" : "translateX";
          track.style.transition = animate ? "transform 0.6s ease" : "none";
          track.style.transform = `${direction}(-${offset}px)`;

          if (animate) {
            isTransitioning = true;
            setTimeout(() => {
              isTransitioning = false;
              resetPositionIfNeeded();
            }, 600);
          }
        }

        function resetPositionIfNeeded() {
          const resetThreshold = images.length * 2;
          const middlePosition = Math.floor(slides.length / 2);
          if (
            currentPhysicalIndex < resetThreshold ||
            currentPhysicalIndex > slides.length - resetThreshold
          ) {
            const targetLogical = currentLogicalIndex;
            currentPhysicalIndex =
              middlePosition +
              (targetLogical - (middlePosition % images.length));
            updateSlider(false);
          }
        }

        function nextSlide() {
          if (isTransitioning) return;
          currentPhysicalIndex++;
          currentLogicalIndex = (currentLogicalIndex + 1) % images.length;
          updateSlider(true);
        }

        function prevSlide() {
          if (isTransitioning) return;
          currentPhysicalIndex--;
          currentLogicalIndex =
            (currentLogicalIndex - 1 + images.length) % images.length;
          updateSlider(true);
        }

        function bindEvents() {
          document
            .querySelectorAll(
              `.next-button[data-target="${trackId.slice(-1)}"]`
            )
            .forEach((btn) => btn.addEventListener("click", nextSlide));
          document
            .querySelectorAll(
              `.prev-button[data-target="${trackId.slice(-1)}"]`
            )
            .forEach((btn) => btn.addEventListener("click", prevSlide));

          window.addEventListener("resize", () => {
            isMobile = window.innerWidth <= 768;
            calculateWidths();
            applyWidths();
            updateSlider(false);
          });
        }

        buildInfiniteTrack();
        updateSlider(false);
        bindEvents();
      }

      // Inicializa os dois sliders
      initSlider(salgados, "sliderTrack1", "slider-wrapper1");
      initSlider(doces, "sliderTrack2", "slider-wrapper2");
      const btnOrder = document.querySelectorAll(".btn-order");

      function openOrder(item) {
        const orderDiv = document.getElementById("orderBox");

        orderDiv.innerHTML = `
    <div class="order-content">
      <button type="button" class="btn-info" onclick="toggleInfo()"><img src="/image/info.png" alt="Info" class="info"></button>
      <h3>${item.label}</h3>
      <img src="${item.src}" alt="${item.label}" style="width: 200px;">
      <p id="text">${item.text}</p>
      <div class="precos" role="region" tabindex="0">
<table>
    <caption>
        <p>Preços</p>
    </caption>
    <thead>
        <tr>
            <th>Tamanho</th>
            <th>£</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Pequeno&nbsp;</td>
            <td>${item.price.small.toFixed(2)}</td>
        </tr>
        <tr>
            <td>Medio</td>
            <td>${item.price.medium.toFixed(2)}</td>
        </tr>
    </tbody>
</table>
</div>
      <div id="quantidade-order">
      <div class="custom-select">
      <select name="tamanho" id="tamanho" required >
      <option value="" disabled selected>Tamanho</option>
      <option value="Pequeno">P</option>
      <option value="Medio">M</option>
      </select>
      </div>
      </div>
      <input type="number" min="1" value="0" id="quantityInput" placeholder="Quantidade"  required disabled />
      <div class="btns-order">
      <button onclick="addToBasket('${item.id}', '${item.label}', '${
          item.src
        }')" id="adicionar">
      <img src="/image/add.png" alt="Add" class="add-img">
      </button>
      <p id="soma"></p>
      <button onclick="closeOrder()" id="close" type="button"><img src="/image/delete.png" alt="Close" id="close-img">
      </button>
      </div>
    </div>
  `;

        orderDiv.style.display = "block";
        document.getElementById("container").style.opacity = "0.5";
        for (let i = 0; i < btnOrder.length; i++) {
          btnOrder[i].setAttribute("disabled", "");
        }
        const quantityInput = document.getElementById("quantityInput");
        const somaElement = document.getElementById("soma");
        const tamanhoSelect = document.getElementById("tamanho");

        tamanhoSelect.addEventListener("change", function () {
          if (tamanhoSelect.value === "Pequeno") {
            quantityInput.setAttribute("min", `${item.pequeno.mim}`);
            quantityInput.setAttribute("value", `${item.pequeno.value}`);
            quantityInput.removeAttribute("disabled");
          } else if (tamanhoSelect.value === "Medio") {
            quantityInput.setAttribute("min", `${item.medio.mim}`);
            quantityInput.setAttribute("value", `${item.medio.value}`);
            quantityInput.removeAttribute("disabled");
          } else {
            quantityInput.setAttribute("disabled", "");
          }
        });

        function atualizarTotal() {
          const value = parseInt(quantityInput.value, 10);
          const tamanho = tamanhoSelect.value; // "Pequeno" ou "Medio"

          let precoUnitario;

          if (tamanho === "Pequeno") {
            precoUnitario = item.price.small;
          } else if (tamanho === "Medio") {
            precoUnitario = item.price.medium;
          } else {
            somaElement.textContent = "Tamanho...";
            return;
          }

          if (!isNaN(value) && value >= 0) {
            const total = value * precoUnitario;
            somaElement.textContent = total.toFixed(2);
          } else {
            somaElement.textContent = " £0.00";
          }
        }

        quantityInput.addEventListener("input", atualizarTotal);
        tamanhoSelect.addEventListener("change", atualizarTotal);

        // Atualizar total ao abrir
        atualizarTotal();
      }

      function closeOrder() {
        document.getElementById("orderBox").style.display = "none";
        document.getElementById("container").style.opacity = "1";

        for (let i = 0; i < btnOrder.length; i++) {
          btnOrder[i].removeAttribute("disabled", "");
        }
      }

      // Close and open info button

      function toggleInfo() {
        if (document.getElementById("text").style.display === "flex") {
          document.getElementById("text").style.display = "none";
        } else {
          document.getElementById("text").style.display = "flex";
        }
      }

      // Função para adicionar ao carrinho

      let arry = [];

      function addToBasket(id, label, src, price) {
        const quantity =
          parseInt(document.getElementById("quantityInput").value) || 1;
        const somaE = document.getElementById("soma");
        const somaTotal = parseFloat(somaE.textContent) || 0;

        const finalOrder = document.getElementById("final-order");
        const basketQt = document.getElementById("basket-qt");
        const basketItem = document.getElementById("basket-item");

        // Adiciona o valor ao array
        arry.push(somaTotal);

        // Cria o item do carrinho com botão de deletar
        const pedido = document.createElement("div");
        pedido.classList.add("pedidos");
        pedido.setAttribute("data-price", somaTotal);

        pedido.innerHTML = `
    <ul>
      <li><img src="${src}" alt="${label}" class="imgs"></li>
      <li>${label}</li>
      <li>QT: ${quantity}</li>
      <li><span>£ </span>${somaTotal.toFixed(2)}</li>
    </ul>
    <button type="button" class="delete"><img src="/image/Delete1.png" alt="Delete" class="imgs"></button>
  `;

        // Adiciona listener ao botão de deletar
        const deleteBtn = pedido.querySelector(".delete");
        deleteBtn.addEventListener("click", () => {
          const itemValue = parseFloat(pedido.getAttribute("data-price"));

          // Remove o item visualmente
          pedido.remove();

          // Remove o valor do array
          const index = arry.indexOf(itemValue);
          if (index !== -1) {
            arry.splice(index, 1);
          }

          // Recalcula total
          updateTotal();
        });

        // Adiciona o item ao carrinho
        basketItem.appendChild(pedido);

        // Atualiza total e quantidade
        updateTotal();

        console.log("Adicionar ao carrinho:", {
          id,
          label,
          src,
          quantity,
          price,
        });

        closeOrder();
      }

      function updateTotal() {
        const finalOrder = document.getElementById("final-order");
        const basketQt = document.getElementById("basket-qt");

        const total = arry.reduce((sum, val) => sum + val, 0);
        finalOrder.innerHTML = `<p id="total-order">Total: £ ${total.toFixed(
          2
        )}</p>`;
        basketQt.textContent = arry.length;
      }

      function closeOrderBasket() {
        document.getElementById("basket").style.display = "none";
        document.getElementById("box-img").src = "/image/box_close.png";
      }

      function openBasket() {
        if (arry.length === 0) {
          const message = document.getElementById("message");
          message.style.display = "block";

          message.textContent =
            "Carrinho vazio! Adicione itens antes de abrir o carrinho.";
          setTimeout(() => {
            message.textContent = "";
            message.style.display = "none";
          }, 5000);
        } else {
          if (document.getElementById("basket").style.display === "flex") {
            document.getElementById("basket").style.display = "none";
            document.getElementById("box-img").src = "/image/box_close.png";
          } else {
            document.getElementById("basket").style.display = "flex";
            document.getElementById("box-img").src = "/image/box_open.png";
          }
        }
      }

      // Menu

      
    </script>
  </body>
</html>
